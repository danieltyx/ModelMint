{"version":3,"file":"openloginJrpc.cjs.js","mappings":"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","sources":["webpack://@toruslabs/openlogin-jrpc/./src/basePostMessageStream.ts","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"@toruslabs/openlogin-utils\"","webpack://@toruslabs/openlogin-jrpc/./src/jrpc.ts","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"eth-rpc-errors\"","webpack://@toruslabs/openlogin-jrpc/./src/jrpcEngine.ts","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"end-of-stream\"","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"once\"","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"pump\"","webpack://@toruslabs/openlogin-jrpc/./src/mux.ts","webpack://@toruslabs/openlogin-jrpc/./src/postMessageStream.ts","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"events\"","webpack://@toruslabs/openlogin-jrpc/./src/safeEventEmitter.ts","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"fast-safe-stringify\"","webpack://@toruslabs/openlogin-jrpc/./src/serializableError.ts","webpack://@toruslabs/openlogin-jrpc/./src/substream.ts","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@toruslabs/openlogin-jrpc/external commonjs2 \"readable-stream\"","webpack://@toruslabs/openlogin-jrpc/webpack/bootstrap","webpack://@toruslabs/openlogin-jrpc/webpack/runtime/compat get default export","webpack://@toruslabs/openlogin-jrpc/webpack/runtime/define property getters","webpack://@toruslabs/openlogin-jrpc/webpack/runtime/hasOwnProperty shorthand","webpack://@toruslabs/openlogin-jrpc/webpack/runtime/make namespace object","webpack://@toruslabs/openlogin-jrpc/./src/index.ts"],"sourcesContent":["import { Duplex } from \"readable-stream\";\n\nfunction noop(): void {\n  return undefined;\n}\n\nconst SYN = \"SYN\";\nconst ACK = \"ACK\";\nconst BRK = \"BRK\";\n\nexport default class BasePostMessageStream extends Duplex {\n  _init: boolean;\n\n  _haveSyn: boolean;\n\n  _name: string;\n\n  _target: string;\n\n  _targetWindow: Window;\n\n  _targetOrigin: string;\n\n  _onMessage: any;\n\n  _synIntervalId: number;\n\n  constructor({\n    name,\n    target,\n    targetWindow = window,\n    targetOrigin = \"*\",\n  }: {\n    name: string;\n    target: string;\n    targetWindow?: Window;\n    targetOrigin?: string;\n  }) {\n    super({\n      objectMode: true,\n    });\n    if (!name || !target) {\n      throw new Error(\"Invalid input.\");\n    }\n    this._init = false;\n    this._haveSyn = false;\n    this._name = name;\n    this._target = target; // target origin\n    this._targetWindow = targetWindow;\n    this._targetOrigin = targetOrigin;\n    this._onMessage = this.onMessage.bind(this);\n    this._synIntervalId = null;\n\n    window.addEventListener(\"message\", this._onMessage, false);\n    this._handShake();\n  }\n\n  _break(): void {\n    this.cork();\n    this._write(BRK, null, noop);\n    this._haveSyn = false;\n    this._init = false;\n  }\n\n  _handShake(): void {\n    this._write(SYN, null, noop);\n    this.cork();\n  }\n\n  _onData(data: unknown): void {\n    if (!this._init) {\n      // listen for handshake\n      if (data === SYN) {\n        this._haveSyn = true;\n        this._write(ACK, null, noop);\n      } else if (data === ACK) {\n        this._init = true;\n        if (!this._haveSyn) {\n          this._write(ACK, null, noop);\n        }\n        this.uncork();\n      }\n    } else if (data === BRK) {\n      this._break();\n    } else {\n      // forward message\n      try {\n        this.push(data);\n      } catch (err) {\n        this.emit(\"error\", err);\n      }\n    }\n  }\n\n  _postMessage(data: unknown): void {\n    const originConstraint = this._targetOrigin;\n    this._targetWindow.postMessage(\n      {\n        target: this._target,\n        data,\n      },\n      originConstraint\n    );\n  }\n\n  onMessage(event: MessageEvent): void {\n    const message = event.data;\n\n    // validate message\n    if (\n      (this._targetOrigin !== \"*\" && event.origin !== this._targetOrigin) ||\n      event.source !== this._targetWindow ||\n      typeof message !== \"object\" ||\n      message.target !== this._name ||\n      !message.data\n    ) {\n      return;\n    }\n\n    this._onData(message.data);\n  }\n\n  _read(): void {\n    return undefined;\n  }\n\n  _write(data: unknown, _, cb: () => void): void {\n    this._postMessage(data);\n    cb();\n  }\n\n  _destroy(): void {\n    window.removeEventListener(\"message\", this._onMessage, false);\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/openlogin-utils\");","import { randomId } from \"@toruslabs/openlogin-utils\";\nimport { Duplex } from \"readable-stream\";\n\nimport SafeEventEmitter from \"./safeEventEmitter\";\nimport SerializableError from \"./serializableError\";\n\nexport type Json = boolean | number | string | null | { [property: string]: Json } | Json[];\n\nexport type JRPCVersion = \"2.0\";\nexport type JRPCId = number | string | void;\n\nexport type ConsoleLike = Pick<Console, \"log\" | \"warn\" | \"error\" | \"debug\" | \"info\" | \"trace\">;\nexport interface JRPCBase {\n  jsonrpc?: JRPCVersion;\n  id?: JRPCId;\n}\n\nexport interface JRPCResponse<T> extends JRPCBase {\n  result?: T;\n  error?: any;\n}\n\nexport const getRpcPromiseCallback =\n  (resolve: (value?: any) => void, reject: (error?: Error) => void, unwrapResult = true) =>\n  (error: Error, response: JRPCResponse<unknown>): void => {\n    if (error || response.error) {\n      reject(error || response.error);\n    } else if (!unwrapResult || Array.isArray(response)) {\n      resolve(response);\n    } else {\n      resolve(response.result);\n    }\n  };\n\nexport interface JRPCRequest<T> extends JRPCBase {\n  method: string;\n  params?: T;\n}\n\nexport type JRPCEngineNextCallback = (cb?: (done: (error?: Error) => void) => void) => void;\nexport type JRPCEngineEndCallback = (error?: Error) => void;\nexport type JRPCEngineReturnHandler = (done: (error?: Error) => void) => void;\n\ninterface IdMapValue {\n  req: JRPCRequest<unknown>;\n  res: JRPCResponse<unknown>;\n  next: JRPCEngineNextCallback;\n  end: JRPCEngineEndCallback;\n}\n\ninterface IdMap {\n  [requestId: string]: IdMapValue;\n}\n\nexport type JRPCMiddleware<T, U> = (req: JRPCRequest<T>, res: JRPCResponse<U>, next: JRPCEngineNextCallback, end: JRPCEngineEndCallback) => void;\n\nexport function createErrorMiddleware(log: ConsoleLike): JRPCMiddleware<unknown, unknown> {\n  return (req, res, next, end) => {\n    try {\n      // json-rpc-engine will terminate the request when it notices this error\n      if (typeof req.method !== \"string\" || !req.method) {\n        res.error = new SerializableError({ code: -32603, message: \"invalid method\" });\n        end();\n        return;\n      }\n      next((done) => {\n        const { error } = res;\n        if (!error) {\n          return done();\n        }\n        log.error(`OpenLogin - RPC Error: ${error.message}`, error);\n        return done();\n      });\n    } catch (error) {\n      log.error(`OpenLogin - RPC Error thrown: ${error.message}`, error);\n      res.error = new SerializableError({ code: -32603, message: error.message });\n      end();\n    }\n  };\n}\n\nexport function createStreamMiddleware(): { events: SafeEventEmitter; middleware: JRPCMiddleware<unknown, unknown>; stream: Duplex } {\n  const idMap: IdMap = {};\n\n  function readNoop() {\n    return false;\n  }\n\n  const events = new SafeEventEmitter();\n\n  function processResponse(res: JRPCResponse<unknown>) {\n    const context = idMap[res.id as unknown as string];\n    if (!context) {\n      throw new Error(`StreamMiddleware - Unknown response id \"${res.id}\"`);\n    }\n\n    delete idMap[res.id as unknown as string];\n    // copy whole res onto original res\n    Object.assign(context.res, res);\n    // run callback on empty stack,\n    // prevent internal stream-handler from catching errors\n    setTimeout(context.end);\n  }\n\n  function processNotification(res: JRPCRequest<unknown>) {\n    events.emit(\"notification\", res);\n  }\n\n  function processMessage(res: JRPCResponse<unknown>, _encoding: unknown, cb: (error?: Error | null) => void) {\n    let err;\n    try {\n      const isNotification = !res.id;\n      if (isNotification) {\n        processNotification(res as unknown as JRPCRequest<unknown>);\n      } else {\n        processResponse(res);\n      }\n    } catch (_err) {\n      err = _err;\n    }\n    // continue processing stream\n    cb(err);\n  }\n\n  const stream = new Duplex({\n    objectMode: true,\n    read: readNoop,\n    write: processMessage,\n  });\n\n  const middleware: JRPCMiddleware<unknown, unknown> = (req, res, next, end) => {\n    // write req to stream\n    stream.push(req);\n    // register request on id map\n    idMap[req.id as unknown as string] = { req, res, next, end };\n  };\n\n  return { events, middleware, stream };\n}\n\ntype ScaffoldMiddlewareHandler<T, U> = JRPCMiddleware<T, U> | Json;\n\nexport function createScaffoldMiddleware(handlers: {\n  [methodName: string]: ScaffoldMiddlewareHandler<unknown, unknown>;\n}): JRPCMiddleware<unknown, unknown> {\n  return (req, res, next, end) => {\n    const handler = handlers[req.method];\n    // if no handler, return\n    if (handler === undefined) {\n      return next();\n    }\n    // if handler is fn, call as middleware\n    if (typeof handler === \"function\") {\n      return handler(req, res, next, end);\n    }\n    // if handler is some other value, use as result\n    res.result = handler;\n    return end();\n  };\n}\n\nexport function createIdRemapMiddleware(): JRPCMiddleware<unknown, unknown> {\n  return (req, res, next, _end) => {\n    const originalId = req.id;\n    const newId = randomId();\n    req.id = newId;\n    res.id = newId;\n    next((done) => {\n      req.id = originalId;\n      res.id = originalId;\n      done();\n    });\n  };\n}\n\nexport function createLoggerMiddleware(logger: ConsoleLike): JRPCMiddleware<unknown, unknown> {\n  return (req, res, next, _) => {\n    logger.debug(\"REQ\", req, \"RES\", res);\n    next();\n  };\n}\n\nexport type AsyncJRPCEngineNextCallback = () => Promise<void>;\n\ntype Maybe<T> = Partial<T> | null | undefined;\n\nexport interface JRPCSuccess<T> extends JRPCBase {\n  result: Maybe<T>;\n}\n\nexport interface JRPCError {\n  code: number;\n  message: string;\n  data?: unknown;\n  stack?: string;\n}\n\nexport interface PendingJRPCResponse<T> extends JRPCBase {\n  result?: T;\n  error?: Error | JRPCError;\n}\n\nexport interface JRPCFailure extends JRPCBase {\n  error: JRPCError;\n}\n\nexport type AsyncJRPCMiddleware<T, U> = (req: JRPCRequest<T>, res: PendingJRPCResponse<U>, next: AsyncJRPCEngineNextCallback) => Promise<void>;\n\ntype ReturnHandlerCallback = (error: null | Error) => void;\n\nexport function createAsyncMiddleware<T, U>(asyncMiddleware: AsyncJRPCMiddleware<T, U>): JRPCMiddleware<T, U> {\n  return async (req, res, next, end) => {\n    // nextPromise is the key to the implementation\n    // it is resolved by the return handler passed to the\n    // \"next\" function\n    let resolveNextPromise: () => void;\n    const nextPromise = new Promise<void>((resolve) => {\n      resolveNextPromise = resolve;\n    });\n\n    let returnHandlerCallback: unknown = null;\n    let nextWasCalled = false;\n\n    // This will be called by the consumer's async middleware.\n    const asyncNext = async () => {\n      nextWasCalled = true;\n\n      // We pass a return handler to next(). When it is called by the engine,\n      // the consumer's async middleware will resume executing.\n\n      next((runReturnHandlersCallback) => {\n        // This callback comes from JRPCEngine._runReturnHandlers\n        returnHandlerCallback = runReturnHandlersCallback;\n        resolveNextPromise();\n      });\n      await nextPromise;\n    };\n\n    try {\n      await asyncMiddleware(req, res, asyncNext);\n\n      if (nextWasCalled) {\n        await nextPromise; // we must wait until the return handler is called\n        (returnHandlerCallback as ReturnHandlerCallback)(null);\n      } else {\n        end(null);\n      }\n    } catch (error) {\n      if (returnHandlerCallback) {\n        (returnHandlerCallback as ReturnHandlerCallback)(error);\n      } else {\n        end(error);\n      }\n    }\n  };\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"eth-rpc-errors\");","import { serializeError } from \"eth-rpc-errors\";\nimport { Duplex } from \"readable-stream\";\n\nimport { JRPCEngineEndCallback, JRPCEngineNextCallback, JRPCEngineReturnHandler, JRPCMiddleware, JRPCRequest, JRPCResponse } from \"./jrpc\";\nimport SafeEventEmitter from \"./safeEventEmitter\";\nimport SerializableError from \"./serializableError\";\n\n/**\n * A JSON-RPC request and response processor.\n * Give it a stack of middleware, pass it requests, and get back responses.\n */\nexport class JRPCEngine extends SafeEventEmitter {\n  private _middleware: JRPCMiddleware<unknown, unknown>[];\n\n  constructor() {\n    super();\n    this._middleware = [];\n  }\n\n  /**\n   * Serially executes the given stack of middleware.\n   *\n   * @returns An array of any error encountered during middleware execution,\n   * a boolean indicating whether the request was completed, and an array of\n   * middleware-defined return handlers.\n   */\n  private static async _runAllMiddleware(\n    req: JRPCRequest<unknown>,\n    res: JRPCResponse<unknown>,\n    middlewareStack: JRPCMiddleware<unknown, unknown>[]\n  ): Promise<\n    [\n      unknown, // error\n      boolean, // isComplete\n      JRPCEngineReturnHandler[]\n    ]\n  > {\n    const returnHandlers: JRPCEngineReturnHandler[] = [];\n    let error = null;\n    let isComplete = false;\n\n    // Go down stack of middleware, call and collect optional returnHandlers\n    for (const middleware of middlewareStack) {\n      [error, isComplete] = await JRPCEngine._runMiddleware(req, res, middleware, returnHandlers);\n      if (isComplete) {\n        break;\n      }\n    }\n    return [error, isComplete, returnHandlers.reverse()];\n  }\n\n  /**\n   * Runs an individual middleware.\n   *\n   * @returns An array of any error encountered during middleware exection,\n   * and a boolean indicating whether the request should end.\n   */\n  private static _runMiddleware(\n    req: JRPCRequest<unknown>,\n    res: JRPCResponse<unknown>,\n    middleware: JRPCMiddleware<unknown, unknown>,\n    returnHandlers: JRPCEngineReturnHandler[]\n  ): Promise<[unknown, boolean]> {\n    return new Promise((resolve) => {\n      const end: JRPCEngineEndCallback = (err?: unknown) => {\n        const error = err || res.error;\n        if (error) {\n          res.error = serializeError(error);\n        }\n        // True indicates that the request should end\n        resolve([error, true]);\n      };\n\n      const next: JRPCEngineNextCallback = (returnHandler?: JRPCEngineReturnHandler) => {\n        if (res.error) {\n          end(res.error);\n        } else {\n          if (returnHandler) {\n            if (typeof returnHandler !== \"function\") {\n              end(new SerializableError({ code: -32603, message: \"JRPCEngine: 'next' return handlers must be functions\" }));\n            }\n            returnHandlers.push(returnHandler);\n          }\n\n          // False indicates that the request should not end\n          resolve([null, false]);\n        }\n      };\n\n      try {\n        middleware(req, res, next, end);\n      } catch (error) {\n        end(error);\n      }\n    });\n  }\n\n  /**\n   * Serially executes array of return handlers. The request and response are\n   * assumed to be in their scope.\n   */\n  private static async _runReturnHandlers(handlers: JRPCEngineReturnHandler[]): Promise<void> {\n    for (const handler of handlers) {\n      await new Promise<void>((resolve, reject) => {\n        handler((err) => (err ? reject(err) : resolve()));\n      });\n    }\n  }\n\n  /**\n   * Throws an error if the response has neither a result nor an error, or if\n   * the \"isComplete\" flag is falsy.\n   */\n  private static _checkForCompletion(req: JRPCRequest<unknown>, res: JRPCResponse<unknown>, isComplete: boolean): void {\n    if (!(\"result\" in res) && !(\"error\" in res)) {\n      throw new SerializableError({ code: -32603, message: \"Response has no error or result for request\" });\n    }\n    if (!isComplete) {\n      throw new SerializableError({ code: -32603, message: \"Nothing ended request\" });\n    }\n  }\n\n  /**\n   * Add a middleware function to the engine's middleware stack.\n   *\n   * @param middleware - The middleware function to add.\n   */\n  push<T, U>(middleware: JRPCMiddleware<T, U>): void {\n    this._middleware.push(middleware as JRPCMiddleware<unknown, unknown>);\n  }\n\n  /**\n   * Handle a JSON-RPC request, and return a response.\n   *\n   * @param request - The request to handle.\n   * @param callback - An error-first callback that will receive the response.\n   */\n  handle<T, U>(request: JRPCRequest<T>, callback: (error: unknown, response: JRPCResponse<U>) => void): void;\n\n  /**\n   * Handle an array of JSON-RPC requests, and return an array of responses.\n   *\n   * @param request - The requests to handle.\n   * @param callback - An error-first callback that will receive the array of\n   * responses.\n   */\n  handle<T, U>(requests: JRPCRequest<T>[], callback: (error: unknown, responses: JRPCResponse<U>[]) => void): void;\n\n  /**\n   * Handle a JSON-RPC request, and return a response.\n   *\n   * @param request - The request to handle.\n   * @returns A promise that resolves with the response, or rejects with an\n   * error.\n   */\n  handle<T, U>(request: JRPCRequest<T>): Promise<JRPCResponse<U>>;\n\n  /**\n   * Handle an array of JSON-RPC requests, and return an array of responses.\n   *\n   * @param request - The requests to handle.\n   * @returns A promise that resolves with the array of responses, or rejects\n   * with an error.\n   */\n  handle<T, U>(requests: JRPCRequest<T>[]): Promise<JRPCResponse<U>[]>;\n\n  handle(req: unknown, cb?: any) {\n    if (cb && typeof cb !== \"function\") {\n      throw new Error('\"callback\" must be a function if provided.');\n    }\n\n    if (Array.isArray(req)) {\n      if (cb) {\n        return this._handleBatch(req, cb);\n      }\n      return this._handleBatch(req);\n    }\n\n    if (cb) {\n      return this._handle(req as JRPCRequest<unknown>, cb);\n    }\n    return this._promiseHandle(req as JRPCRequest<unknown>);\n  }\n\n  /**\n   * Returns this engine as a middleware function that can be pushed to other\n   * engines.\n   *\n   * @returns This engine as a middleware function.\n   */\n  asMiddleware(): JRPCMiddleware<unknown, unknown> {\n    return async (req, res, next, end) => {\n      try {\n        const [middlewareError, isComplete, returnHandlers] = await JRPCEngine._runAllMiddleware(req, res, this._middleware);\n\n        if (isComplete) {\n          await JRPCEngine._runReturnHandlers(returnHandlers);\n          return end(middlewareError as Error);\n        }\n\n        return next(async (handlerCallback) => {\n          try {\n            await JRPCEngine._runReturnHandlers(returnHandlers);\n          } catch (error) {\n            return handlerCallback(error);\n          }\n          return handlerCallback();\n        });\n      } catch (error) {\n        return end(error);\n      }\n    };\n  }\n\n  /**\n   * Like _handle, but for batch requests.\n   */\n  private _handleBatch(reqs: JRPCRequest<unknown>[]): Promise<JRPCResponse<unknown>[]>;\n\n  /**\n   * Like _handle, but for batch requests.\n   */\n  private _handleBatch(reqs: JRPCRequest<unknown>[], cb: (error: unknown, responses?: JRPCResponse<unknown>[]) => void): Promise<void>;\n\n  private async _handleBatch(\n    reqs: JRPCRequest<unknown>[],\n    cb?: (error: unknown, responses?: JRPCResponse<unknown>[]) => void\n  ): Promise<JRPCResponse<unknown>[] | void> {\n    // The order here is important\n    try {\n      // 2. Wait for all requests to finish, or throw on some kind of fatal\n      // error\n      const responses = await Promise.all(\n        // 1. Begin executing each request in the order received\n        reqs.map(this._promiseHandle.bind(this))\n      );\n\n      // 3. Return batch response\n      if (cb) {\n        return cb(null, responses);\n      }\n      return responses;\n    } catch (error) {\n      if (cb) {\n        return cb(error);\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * A promise-wrapped _handle.\n   */\n  private _promiseHandle(req: JRPCRequest<unknown>): Promise<JRPCResponse<unknown>> {\n    return new Promise((resolve) => {\n      this._handle(req, (_err, res) => {\n        // There will always be a response, and it will always have any error\n        // that is caught and propagated.\n        resolve(res);\n      });\n    });\n  }\n\n  /**\n   * Ensures that the request object is valid, processes it, and passes any\n   * error and the response object to the given callback.\n   *\n   * Does not reject.\n   */\n  private async _handle(callerReq: JRPCRequest<unknown>, cb: (error: unknown, response: JRPCResponse<unknown>) => void): Promise<void> {\n    if (!callerReq || Array.isArray(callerReq) || typeof callerReq !== \"object\") {\n      const error = new SerializableError({ code: -32603, message: \"request must be plain object\" });\n      return cb(error, { id: undefined, jsonrpc: \"2.0\", error });\n    }\n\n    if (typeof callerReq.method !== \"string\") {\n      const error = new SerializableError({ code: -32603, message: \"method must be string\" });\n      return cb(error, { id: callerReq.id, jsonrpc: \"2.0\", error });\n    }\n\n    const req: JRPCRequest<unknown> = { ...callerReq };\n    const res: JRPCResponse<unknown> = {\n      id: req.id,\n      jsonrpc: req.jsonrpc,\n    };\n    let error: Error = null;\n\n    try {\n      await this._processRequest(req, res);\n    } catch (_error) {\n      // A request handler error, a re-thrown middleware error, or something\n      // unexpected.\n      error = _error;\n    }\n\n    if (error) {\n      // Ensure no result is present on an errored response\n      delete res.result;\n      if (!res.error) {\n        res.error = serializeError(error);\n      }\n    }\n\n    return cb(error, res as JRPCResponse<unknown>);\n  }\n\n  /**\n   * For the given request and response, runs all middleware and their return\n   * handlers, if any, and ensures that internal request processing semantics\n   * are satisfied.\n   */\n  private async _processRequest(req: JRPCRequest<unknown>, res: JRPCResponse<unknown>): Promise<void> {\n    const [error, isComplete, returnHandlers] = await JRPCEngine._runAllMiddleware(req, res, this._middleware);\n\n    // Throw if \"end\" was not called, or if the response has neither a result\n    // nor an error.\n    JRPCEngine._checkForCompletion(req, res, isComplete);\n\n    // The return handlers should run even if an error was encountered during\n    // middleware processing.\n    await JRPCEngine._runReturnHandlers(returnHandlers);\n\n    // Now we re-throw the middleware processing error, if any, to catch it\n    // further up the call chain.\n    if (error) {\n      throw error;\n    }\n  }\n}\n\nexport function mergeMiddleware(middlewareStack: JRPCMiddleware<unknown, unknown>[]): JRPCMiddleware<unknown, unknown> {\n  const engine = new JRPCEngine();\n  middlewareStack.forEach((middleware) => engine.push(middleware));\n  return engine.asMiddleware();\n}\n\nexport interface EngineStreamOptions {\n  engine: JRPCEngine;\n}\n\nexport function createEngineStream(opts: EngineStreamOptions): Duplex {\n  if (!opts || !opts.engine) {\n    throw new Error(\"Missing engine parameter!\");\n  }\n\n  const { engine } = opts;\n  // eslint-disable-next-line prefer-const\n  let stream: Duplex;\n\n  function read() {\n    return undefined;\n  }\n\n  function write(req: JRPCRequest<unknown>, _encoding: unknown, cb: (error?: Error | null) => void) {\n    engine.handle(req, (_err, res) => {\n      stream.push(res);\n    });\n    cb();\n  }\n\n  stream = new Duplex({ objectMode: true, read, write });\n\n  // forward notifications\n  if (engine.on) {\n    engine.on(\"notification\", (message) => {\n      stream.push(message);\n    });\n  }\n  return stream;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"end-of-stream\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"once\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"pump\");","import { BufferEncoding } from \"@toruslabs/openlogin-utils\";\nimport eos from \"end-of-stream\";\nimport once from \"once\";\nimport pump from \"pump\";\nimport { Duplex } from \"readable-stream\";\nimport type { Readable, Writable } from \"stream\";\n\nimport Substream from \"./substream\";\n\nexport const IGNORE_SUBSTREAM = Symbol(\"IGNORE_SUBSTREAM\");\n\nexport type Stream = Readable | Writable;\n\ninterface Chunk {\n  name: string;\n  data: unknown;\n}\n\nexport class ObjectMultiplex extends Duplex {\n  public _substreams: Record<string, Substream | typeof IGNORE_SUBSTREAM>;\n\n  getStream: (name: string) => Substream | symbol;\n\n  constructor(opts: Record<string, unknown> = {}) {\n    super({\n      ...opts,\n      objectMode: true,\n    });\n    this._substreams = {};\n  }\n\n  createStream(name: string): Substream {\n    // validate name\n    if (!name) {\n      throw new Error(\"ObjectMultiplex - name must not be empty\");\n    }\n\n    if (this._substreams[name]) {\n      throw new Error(`ObjectMultiplex - Substream for name \"${name}\" already exists`);\n    }\n\n    // create substream\n    const substream = new Substream({ parent: this, name });\n    this._substreams[name] = substream;\n\n    // listen for parent stream to end\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    anyStreamEnd(this, (_error?: Error | null) => substream.destroy(_error || undefined));\n\n    return substream;\n  }\n\n  // ignore streams (dont display orphaned data warning)\n  ignoreStream(name: string): void {\n    // validate name\n    if (!name) {\n      throw new Error(\"ObjectMultiplex - name must not be empty\");\n    }\n    if (this._substreams[name]) {\n      throw new Error(`ObjectMultiplex - Substream for name \"${name}\" already exists`);\n    }\n    // set\n    this._substreams[name] = IGNORE_SUBSTREAM;\n  }\n\n  _read(): void {\n    return undefined;\n  }\n\n  _write(chunk: Chunk, _encoding: BufferEncoding, callback: (error?: Error | null) => void): void {\n    const { name, data } = chunk;\n\n    if (!name) {\n      window.console.warn(`ObjectMultiplex - malformed chunk without name \"${chunk}\"`);\n      return callback();\n    }\n\n    // get corresponding substream\n    const substream = this._substreams[name];\n    if (!substream) {\n      window.console.warn(`ObjectMultiplex - orphaned data for stream \"${name}\"`);\n      return callback();\n    }\n\n    // push data into substream\n    if (substream !== IGNORE_SUBSTREAM) {\n      substream.push(data);\n    }\n\n    return callback();\n  }\n}\n\n// util\nfunction anyStreamEnd(stream: ObjectMultiplex, _cb: (error?: Error | null) => void) {\n  const cb = once(_cb);\n  eos(stream as unknown as Stream, { readable: false }, cb);\n  eos(stream as unknown as Stream, { writable: false }, cb);\n}\n\nexport function setupMultiplex(stream: Duplex): ObjectMultiplex {\n  const mux = new ObjectMultiplex();\n  mux.getStream = function streamHelper(name: string) {\n    if (this._substreams[name]) {\n      return this._substreams[name];\n    }\n    return this.createStream(name);\n  };\n\n  pump(stream as unknown as Stream, mux as unknown as Stream, stream as unknown as Stream, (err) => {\n    if (err) window.console.error(err);\n  });\n  return mux;\n}\n","import BasePostMessageStream from \"./basePostMessageStream\";\n\nexport default class PostMessageStream extends BasePostMessageStream {\n  _postMessage(data: unknown): void {\n    let originConstraint = this._targetOrigin;\n    if (typeof data === \"object\") {\n      const dataObj = data as Record<string, unknown>;\n      if (typeof dataObj.data === \"object\") {\n        const dataObjData = dataObj.data as Record<string, unknown>;\n        if (Array.isArray(dataObjData.params) && dataObjData.params.length > 0) {\n          const dataObjDataParam = dataObjData.params[0] as Record<string, unknown>;\n          if (dataObjDataParam._origin) {\n            originConstraint = dataObjDataParam._origin as string;\n          }\n\n          // add a constraint for the response\n          dataObjDataParam._origin = window.location.origin;\n        }\n      }\n    }\n\n    this._targetWindow.postMessage(\n      {\n        target: this._target,\n        data,\n      },\n      originConstraint\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"events\");","import { EventEmitter } from \"events\";\n\ntype Handler = (...args: any[]) => void;\ninterface EventMap {\n  [k: string]: Handler | Handler[] | undefined;\n}\n\nfunction safeApply<T, A extends any[]>(handler: (this: T, ...handlerArgs: A) => void, context: T, args: A): void {\n  try {\n    Reflect.apply(handler, context, args);\n  } catch (err) {\n    // Throw error after timeout so as not to interrupt the stack\n    setTimeout(() => {\n      throw err;\n    });\n  }\n}\n\nfunction arrayClone<T>(arr: T[]): T[] {\n  const n = arr.length;\n  const copy = new Array(n);\n  for (let i = 0; i < n; i += 1) {\n    copy[i] = arr[i];\n  }\n  return copy;\n}\n\nexport default class SafeEventEmitter extends EventEmitter {\n  emit(type: string, ...args: any[]): boolean {\n    let doError = type === \"error\";\n\n    const events: EventMap = (this as any)._events;\n    if (events !== undefined) {\n      doError = doError && events.error === undefined;\n    } else if (!doError) {\n      return false;\n    }\n\n    // If there is no 'error' event listener then throw.\n    if (doError) {\n      let er;\n      if (args.length > 0) {\n        [er] = args;\n      }\n      if (er instanceof Error) {\n        // Note: The comments on the `throw` lines are intentional, they show\n        // up in Node's output if this results in an unhandled exception.\n        throw er; // Unhandled 'error' event\n      }\n      // At least give some kind of context to the user\n      const err = new Error(`Unhandled error.${er ? ` (${er.message})` : \"\"}`);\n      (err as any).context = er;\n      throw err; // Unhandled 'error' event\n    }\n\n    const handler = events[type];\n\n    if (handler === undefined) {\n      return false;\n    }\n\n    if (typeof handler === \"function\") {\n      safeApply(handler, this, args);\n    } else {\n      const len = handler.length;\n      const listeners = arrayClone(handler);\n      for (let i = 0; i < len; i += 1) {\n        safeApply(listeners[i], this, args);\n      }\n    }\n\n    return true;\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"fast-safe-stringify\");","import stringify from \"fast-safe-stringify\";\n\nexport default class SerializableError<T> extends Error {\n  public code: number;\n\n  public data: T;\n\n  constructor({ code, message, data }: { code: number; message: string; data?: T }) {\n    if (!Number.isInteger(code)) {\n      throw new Error(\"code must be an integer\");\n    }\n    if (!message || typeof message !== \"string\") {\n      throw new Error(\"message must be string\");\n    }\n\n    super(message);\n    this.code = code;\n    if (data !== undefined) {\n      this.data = data;\n    }\n  }\n\n  toString(): string {\n    return stringify({\n      code: this.code,\n      message: this.message,\n      data: this.data,\n      stack: this.stack,\n    });\n  }\n}\n","import { BufferEncoding } from \"@toruslabs/openlogin-utils\";\nimport { Duplex } from \"readable-stream\";\n\nexport default class Substream extends Duplex {\n  private readonly _parent: any;\n\n  private readonly _name: string;\n\n  constructor({ parent, name }: { parent: any; name: string }) {\n    super({ objectMode: true });\n    this._parent = parent;\n    this._name = name;\n  }\n\n  /**\n   * Explicitly sets read operations to a no-op.\n   */\n  _read(): void {\n    return undefined;\n  }\n\n  /**\n   * Called when data should be written to this writable stream.\n   *\n   * @param chunk - Arbitrary object to write\n   * @param encoding - Encoding to use when writing payload\n   * @param callback - Called when writing is complete or an error occurs\n   */\n  _write(chunk: unknown, _encoding: BufferEncoding, callback: (error?: Error | null) => void): void {\n    this._parent.push({\n      name: this._name,\n      data: chunk,\n    });\n    callback();\n  }\n}\n","module.exports = require(\"@babel/runtime/helpers/defineProperty\");","module.exports = require(\"readable-stream\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export { default as BasePostMessageStream } from \"./basePostMessageStream\";\nexport * from \"./jrpc\";\nexport * from \"./jrpcEngine\";\nexport * from \"./mux\";\nexport { default as PostMessageStream } from \"./postMessageStream\";\nexport { default as SafeEventEmitter } from \"./safeEventEmitter\";\nexport { default as SerializableError } from \"./serializableError\";\nexport { default as Substream } from \"./substream\";\nexport * from \"./utils\";\n"],"names":["Duplex","noop","undefined","SYN","ACK","BRK","BasePostMessageStream","constructor","_ref","name","target","targetWindow","window","targetOrigin","objectMode","_defineProperty","Error","_init","_haveSyn","_name","_target","_targetWindow","_targetOrigin","_onMessage","onMessage","bind","_synIntervalId","addEventListener","_handShake","_break","cork","_write","_onData","data","uncork","push","err","emit","_postMessage","originConstraint","postMessage","event","message","origin","source","_read","_","cb","_destroy","removeEventListener","randomId","SafeEventEmitter","SerializableError","getRpcPromiseCallback","resolve","reject","unwrapResult","arguments","length","error","response","Array","isArray","result","createErrorMiddleware","log","req","res","next","end","method","code","done","createStreamMiddleware","idMap","readNoop","events","processResponse","context","id","Object","assign","setTimeout","processNotification","processMessage","_encoding","isNotification","_err","stream","read","write","middleware","createScaffoldMiddleware","handlers","handler","createIdRemapMiddleware","_end","originalId","newId","createLoggerMiddleware","logger","debug","createAsyncMiddleware","asyncMiddleware","resolveNextPromise","nextPromise","Promise","returnHandlerCallback","nextWasCalled","asyncNext","runReturnHandlersCallback","serializeError","JRPCEngine","_middleware","_runAllMiddleware","middlewareStack","returnHandlers","isComplete","_runMiddleware","reverse","returnHandler","_runReturnHandlers","_checkForCompletion","handle","_handleBatch","_handle","_promiseHandle","asMiddleware","middlewareError","handlerCallback","reqs","responses","all","map","callerReq","jsonrpc","_objectSpread","_processRequest","_error","mergeMiddleware","engine","forEach","createEngineStream","opts","on","eos","once","pump","Substream","IGNORE_SUBSTREAM","Symbol","ObjectMultiplex","_substreams","createStream","substream","parent","anyStreamEnd","destroy","ignoreStream","chunk","callback","console","warn","_cb","readable","writable","setupMultiplex","mux","getStream","streamHelper","PostMessageStream","dataObj","dataObjData","params","dataObjDataParam","_origin","location","EventEmitter","safeApply","args","Reflect","apply","arrayClone","arr","n","copy","i","type","doError","_events","_len","_key","er","len","listeners","stringify","Number","isInteger","toString","stack","_parent","default"],"sourceRoot":""}